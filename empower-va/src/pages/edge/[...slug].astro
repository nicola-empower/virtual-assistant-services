---
export const prerender = true;
import MainLayout from "../../layouts/MainLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import { ArrowLeft } from "lucide-react";
import JsonLd from "../../components/JsonLd.astro";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    console.log(
        "DEBUG: Generated Blog Slugs:",
        posts.map((p) => p.slug),
    );
    return posts.map((post) => ({
        params: { slug: post.slug },
        props: post,
    }));
}

type Props = CollectionEntry<"blog">;

const post = Astro.props;
const { Content } = await post.render();

const articleSchema = {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    headline: post.data.title,
    description: post.data.description,
    image: new URL(post.data.image || "/default-og.png", Astro.site).toString(),
    datePublished: post.data.pubDate.toISOString(),
    author: {
        "@type": "Person",
        name: post.data.author || "Nicola Berry",
    },
    publisher: {
        "@type": "Organization",
        name: "Empower Virtual Assistant Services",
        logo: {
            "@type": "ImageObject",
            url: "https://empowervaservices.co.uk/logo.png",
        },
    },
};
---

<JsonLd schema={articleSchema} />

<MainLayout
    title={`${post.data.title} | The Edge`}
    description={post.data.description}
    image={post.data.image}
    type="article"
>
    <article class="py-24 bg-white min-h-screen">
        <div class="max-w-3xl mx-auto px-6">
            <a
                href="/edge"
                class="inline-flex items-center gap-2 text-slate-500 hover:text-teal-600 mb-8 font-bold transition-colors"
            >
                <ArrowLeft className="w-4 h-4" /> Back to The Edge
            </a>

            <header class="mb-12">
                <h1
                    class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4 leading-tight"
                >
                    {post.data.title}
                </h1>
                <div class="flex items-center gap-4 text-slate-500 text-sm">
                    <time datetime={post.data.pubDate.toISOString()}>
                        {
                            post.data.pubDate.toLocaleDateString("en-GB", {
                                year: "numeric",
                                month: "long",
                                day: "numeric",
                            })
                        }
                    </time>
                    {
                        post.data.author && (
                            <>
                                <span>â€¢</span>
                                <span>{post.data.author}</span>
                            </>
                        )
                    }
                </div>
            </header>

            <div
                class="prose prose-lg prose-slate max-w-none prose-headings:font-bold prose-headings:text-slate-900 prose-a:text-teal-700 prose-a:no-underline hover:prose-a:underline"
            >
                <Content />
            </div>
        </div>
    </article>
</MainLayout>
